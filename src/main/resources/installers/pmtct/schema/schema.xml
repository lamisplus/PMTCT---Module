<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">

    <property name="autoIncrement" value="true"/>

    <changeSet id="20221007-001" author="drkarim-data-fi">
        <sql>
            CREATE TABLE IF NOT EXISTS public.pmtct_anc
            (
                id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
                anc_no character varying(255) COLLATE pg_catalog."default",
                created_by character varying(255) COLLATE pg_catalog."default",
                created_date timestamp without time zone,
                facility_id bigint,
                hospital_number character varying(255) COLLATE pg_catalog."default",
                last_modified_by character varying(255) COLLATE pg_catalog."default",
                last_modified_date timestamp without time zone,
                uuid character varying(255) COLLATE pg_catalog."default",
                lmp date,
                gaweeks integer,
                gravida integer,
                parity integer,
                archived bigint,
                tested_syphilis character varying(255) COLLATE pg_catalog."default",
                test_result_syphilis character varying(255) COLLATE pg_catalog."default",
                treated_syphilis character varying(255) COLLATE pg_catalog."default",
                referred_syphilis_treatment character varying(255) COLLATE pg_catalog."default",
                pmtct_hts_info jsonb,
                partner_notification jsonb,
                person_uuid character varying(255) COLLATE pg_catalog."default",
                first_anc_date date,
                expected_delivery_date date,
                last_visit_date date,
                next_appointment_date date,
                default_days integer,
                hiv_diognosic_time character varying(100) COLLATE pg_catalog."default",
                status character varying(100) COLLATE pg_catalog."default",
                partner_information jsonb,
                static_hiv_status character varying(255) COLLATE pg_catalog."default",
                source_of_referral character varying(255) COLLATE pg_catalog."default",
                CONSTRAINT pmtct_anc_pkey PRIMARY KEY (id),
                CONSTRAINT anc_no UNIQUE (anc_no)
                )

                TABLESPACE pg_default;

            ALTER TABLE IF EXISTS public.pmtct_anc
                OWNER to postgres;
        </sql>
    </changeSet>

    <changeSet id="20221007-002" author="drkarim-data-fi">
        <sql>

            CREATE TABLE IF NOT EXISTS public.pmtct_enrollment
            (
                id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
                anc_no character varying(255) COLLATE pg_catalog."default",
                created_by character varying(255) COLLATE pg_catalog."default",
                created_date timestamp without time zone,
                facility_id bigint,
                hospital_number character varying(255) COLLATE pg_catalog."default",
                last_modified_by character varying(255) COLLATE pg_catalog."default",
                last_modified_date timestamp without time zone,
                uuid character varying(255) COLLATE pg_catalog."default",
                pmtct_enrollment_date date,
                gaweeks integer,
                gravida integer,
                art_start_date date,
                art_start_time character varying(255) COLLATE pg_catalog."default",
                tb_status character varying(255) COLLATE pg_catalog."default",
                entry_point character varying COLLATE pg_catalog."default",
                CONSTRAINT pmtct_enrollment_pkey PRIMARY KEY (id),
                CONSTRAINT pmtct_enrollment_anc_no_key UNIQUE (anc_no)
                )

                TABLESPACE pg_default;

            ALTER TABLE IF EXISTS public.pmtct_enrollment
                OWNER to postgres;
        </sql>
    </changeSet>
    <changeSet id="20220610-003" author="drkarim-data-fi">
        <sql>
            CREATE TABLE IF NOT EXISTS public.pmtct_delivery
            (
                id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
                anc_no character varying(255) COLLATE pg_catalog."default",
                created_by character varying(255) COLLATE pg_catalog."default",
                created_date timestamp without time zone,
                facility_id bigint,
                hospital_number character varying(255) COLLATE pg_catalog."default",
                last_modified_by character varying(255) COLLATE pg_catalog."default",
                last_modified_date timestamp without time zone,
                uuid character varying(255) COLLATE pg_catalog."default",
                date_of_delivery date,
                booking_status character varying(255) COLLATE pg_catalog."default",
                gaweeks bigint,
                rom_delivery_interval character varying(255) COLLATE pg_catalog."default",
                mode_of_delivery character varying(255) COLLATE pg_catalog."default",
                episiotomy character varying(255) COLLATE pg_catalog."default",
                vaginal_tear character varying(255) COLLATE pg_catalog."default",
                feeding_decision character varying(255) COLLATE pg_catalog."default",
                maternal_outcome character varying(255) COLLATE pg_catalog."default",
                child_status character varying(255) COLLATE pg_catalog."default",
                hiv_exposed_infant_given_hb_within24hrs character varying(255) COLLATE pg_catalog."default",
                child_given_arv_within72 character varying(255) COLLATE pg_catalog."default",
                delivery_time character varying(255) COLLATE pg_catalog."default",
                on_art character varying(255) COLLATE pg_catalog."default",
                art_started_ld_ward character varying(255) COLLATE pg_catalog."default",
                hbstatus character varying(255) COLLATE pg_catalog."default",
                hcstatus character varying(255) COLLATE pg_catalog."default",
                referal_source character varying(255) COLLATE pg_catalog."default",
                number_of_infants_alive bigint DEFAULT 0,
                number_of_infants_dead bigint DEFAULT 0,
                CONSTRAINT pmtct_delivery_pkey PRIMARY KEY (id),
                CONSTRAINT pmtct_delivery_anc_no_key UNIQUE (anc_no)
                )

                TABLESPACE pg_default;

            ALTER TABLE IF EXISTS public.pmtct_delivery
                OWNER to postgres;
        </sql>
    </changeSet>

    <changeSet id="20221201-004" author="drkarim-data-fi">
        <sql>
            CREATE TABLE IF NOT EXISTS public.pmtct_mother_visitation
            (
                id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
                anc_no character varying(255) COLLATE pg_catalog."default",
                person_uuid character varying(255) COLLATE pg_catalog."default",
                hospital_number character varying(255) COLLATE pg_catalog."default",
                date_of_visit date,
                fp_counseling character varying(255) COLLATE pg_catalog."default",
                fp_method character varying(255) COLLATE pg_catalog."default",
                date_of_viral_load date,
                ga_of_viral_load smallint,
                result_of_viral_load smallint,
                dsd_option character varying(255) COLLATE pg_catalog."default",
                dsd_model character varying(255) COLLATE pg_catalog."default",
                maternal_outcome character varying(255) COLLATE pg_catalog."default",
                date_of_maternal_outcome date,
                visit_status character varying(255) COLLATE pg_catalog."default",
                transfer_to character varying(255) COLLATE pg_catalog."default",
                next_appointment_date date,
                uuid character varying(255) COLLATE pg_catalog."default",
                entry_point character varying(255) COLLATE pg_catalog."default",
                dsd character varying(255) COLLATE pg_catalog."default",
                time_of_viral_load character varying(255) COLLATE pg_catalog."default",
                CONSTRAINT pmtct_mother_visitation_pkey PRIMARY KEY (id)
                )

                TABLESPACE pg_default;

            ALTER TABLE IF EXISTS public.pmtct_mother_visitation
                OWNER to postgres;
        </sql>
    </changeSet>

    <changeSet id="20221215-005" author="drkarim-data-fi">
        <sql>
            CREATE TABLE IF NOT EXISTS public.pmtct_infant_information
            (
                id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
                anc_no character varying(255) COLLATE pg_catalog."default",
                created_by character varying(255) COLLATE pg_catalog."default",
                created_date timestamp without time zone,
                facility_id bigint,
                hospital_number character varying(255) COLLATE pg_catalog."default",
                last_modified_by character varying(255) COLLATE pg_catalog."default",
                last_modified_date timestamp without time zone,
                uuid character varying(255) COLLATE pg_catalog."default",
                date_of_delivery date,
                first_name character varying(255) COLLATE pg_catalog."default",
                middle_name character varying(255) COLLATE pg_catalog."default",
                surname character varying(255) COLLATE pg_catalog."default",
                sex character varying(255) COLLATE pg_catalog."default",
                nin character varying(255) COLLATE pg_catalog."default",
                infant_outcome_at18_months character varying(255) COLLATE pg_catalog."default",
                last_visit_date date,
                next_appointment_date date,
                default_days integer,
                CONSTRAINT pmtct_infant_information_pkey PRIMARY KEY (id)

                )
                TABLESPACE pg_default;
            ALTER TABLE IF EXISTS public.pmtct_infant_information
                OWNER to postgres;
        </sql>
    </changeSet>

    <changeSet id="20230118-001" author="drkarim-data-fi">
        <sql>
            CREATE TABLE IF NOT EXISTS public.pmtct_infant_mother_art
            (
                id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
                visit_date date,
                anc_number character varying COLLATE pg_catalog."default",
                mother_art_initiation_time character varying COLLATE pg_catalog."default",
                regimen_type_id bigint,
                regimen_id bigint,
                uuid character varying COLLATE pg_catalog."default" NOT NULL,
                CONSTRAINT pmtct_infant_mother_art_pkey PRIMARY KEY (id)
                )

                TABLESPACE pg_default;

            ALTER TABLE IF EXISTS public.pmtct_infant_mother_art
                OWNER to postgres;

        </sql>
    </changeSet>

    <changeSet id="20230118-002" author="drkarim-data-fi">
        <sql>
            CREATE TABLE IF NOT EXISTS public.pmtct_infant_arv
            (
                id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
                visit_date date,
                infant_hospital_number character varying COLLATE pg_catalog."default",
                anc_number character varying COLLATE pg_catalog."default",
                age_at_ctx character varying COLLATE pg_catalog."default",
                infant_arv_type character varying COLLATE pg_catalog."default",
                infant_arv_time character varying COLLATE pg_catalog."default",
                arv_delivery_point character varying COLLATE pg_catalog."default",
                uuid character varying COLLATE pg_catalog."default" NOT NULL,
                CONSTRAINT pmtct_infant_arv_pkey PRIMARY KEY (id)
                )

                TABLESPACE pg_default;

            ALTER TABLE IF EXISTS public.pmtct_infant_arv
                OWNER to postgres;
        </sql>
    </changeSet>

    <changeSet id="20230118-003" author="drkarim-data-fi">
        <sql>
            CREATE TABLE IF NOT EXISTS public.pmtct_infant_pcr
            (
                id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
                visit_date date,
                infant_hospital_number character varying COLLATE pg_catalog."default",
                anc_number character varying COLLATE pg_catalog."default",
                age_at_test bigint,
                test_type character varying COLLATE pg_catalog."default",
                date_sample_collected date,
                date_sample_sent date,
                date_result_received_at_facility date,
                date_result_received_by_caregiver date,
                results character varying COLLATE pg_catalog."default",
                uuid character varying COLLATE pg_catalog."default" NOT NULL,
                CONSTRAINT pmtct_infant_pcr_pkey PRIMARY KEY (id)
                )

                TABLESPACE pg_default;

            ALTER TABLE IF EXISTS public.pmtct_infant_pcr
                OWNER to postgres;
        </sql>
    </changeSet>

    <changeSet id="20230118-004" author="drkarim-data-fi">
        <sql>
            CREATE TABLE IF NOT EXISTS public.pmtct_infant_visit
            (
                id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
                visit_date date,
                infant_hospital_number character varying COLLATE pg_catalog."default",
                anc_number character varying COLLATE pg_catalog."default",
                body_weight bigint,
                visit_status character varying COLLATE pg_catalog."default",
                ctx_status character varying COLLATE pg_catalog."default",
                breast_feeding character varying COLLATE pg_catalog."default",
                uuid character varying COLLATE pg_catalog."default" NOT NULL,
                CONSTRAINT pmtct_infant_visit_pkey PRIMARY KEY (id)
                )

                TABLESPACE pg_default;

            ALTER TABLE IF EXISTS public.pmtct_infant_visit
                OWNER to postgres;
        </sql>
    </changeSet>
    <changeSet failOnError="false" author="Ajor Victor" id="20231412-001">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM base_application_codeset
                WHERE codeset_group = 'PMTCT_ENTRY_POINT'
            </sqlCheck>
        </preConditions>
        <sqlFile dbms="postgresql"
                 path="sql/pmtct_entry_point.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"
                 stripComments="true"/>
    </changeSet>
</databaseChangeLog>
